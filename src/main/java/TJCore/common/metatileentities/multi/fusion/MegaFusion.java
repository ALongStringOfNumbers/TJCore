package TJCore.common.metatileentities.multi.fusion;

import TJCore.common.TJTextures;
//import TJCore.common.metatileentities.multi.TreeFarmer;
import TJCore.common.recipes.recipemaps.TJRecipeMaps;
import gregtech.api.metatileentity.MetaTileEntity;
import gregtech.api.metatileentity.MetaTileEntityHolder;
import gregtech.api.metatileentity.multiblock.IMultiblockPart;
import gregtech.api.metatileentity.multiblock.RecipeMapMultiblockController;
import gregtech.api.pattern.BlockPattern;
import gregtech.api.pattern.FactoryBlockPattern;
import gregtech.api.pattern.TraceabilityPredicate;
import static gregtech.api.unification.material.Materials.*;

import gregtech.api.unification.material.Materials;
import gregtech.api.util.BlockInfo;
import gregtech.client.renderer.ICubeRenderer;
import gregtech.client.renderer.texture.Textures;
import gregtech.common.blocks.*;
//import net.minecraft.block.BlockGlass;
import net.minecraft.block.state.IBlockState;
import net.minecraft.util.ResourceLocation;
import org.apache.commons.lang3.ArrayUtils;

import javax.annotation.Nonnull;
import java.util.Arrays;
import java.util.Collection;

public class MegaFusion extends RecipeMapMultiblockController {

    public MegaFusion(ResourceLocation metaTileEntityId) {
        super(metaTileEntityId, TJRecipeMaps.COMPONENT_ASSEMBLER_RECIPES);
    }

    @Override
    public TraceabilityPredicate autoAbilities() { return autoAbilities(true, false, true, true, true, true, false); }

    @Override
    protected BlockPattern createStructurePattern() {
        return FactoryBlockPattern.start()
                .aisle("#############################################", "#############################################", "#############################################", "####################BBBBB####################", "##################GGGGGGGGG##################", "##################GGGGGGGGG##################", "##################GGGGGGGGG##################", "####################BBBBB####################", "#############################################", "#############################################", "#############################################")
                .aisle("#############################################", "#############################################", "#################BBBBBBBBBBB#################", "################BBBB##F##BBBB################", "###############GGG####F####GGG###############", "##############GGGG####F####GGGG##############", "###############GGG####F####GGG###############", "################BBBB##F##BBBB################", "#################BBBBBBBBBBB#################", "#############################################", "#############################################")
                .aisle("#############################################", "#################BBBBBBBBBBB#################", "##############BBB#####F#####BBB##############", "#############BBB#############BBB#############", "############GGG###############GGG############", "############GG#################GG############", "############GGG###############GGG############", "#############BBB#############BBB#############", "##############BBB#####F#####BBB##############", "#################BBBBBBBBBBB#################", "#############################################")
                .aisle("###################BBBBBBB###################", "##############BBBBB###F###BBBBB##############", "############BB#################BB############", "###########BB###################BB###########", "###########G#####################G###########", "##########GG#####################GG##########", "###########G#####################G###########", "###########BB###################BB###########", "############BB#################BB############", "##############BBBBB###F###BBBBB##############", "###################BBBBBBB###################")
                .aisle("################BBBBBBBBBBBBB################", "############BBBB######F######BBBB############", "###########B#####################B###########", "##########B#######################B##########", "#########GG#######################GG#########", "#########G#########################G#########", "#########GG#######################GG#########", "##########B#######################B##########", "###########B#####################B###########", "############BBBB######F######BBBB############", "################BBBBBBBBBBBBB################")
                .aisle("#############BBBBBBBBBBBBBBBBBBB#############", "###########BB#########F#########BB###########", "#########BB#######################BB#########", "########BB#########################BB########", "########G###########################G########", "########G###########################G########", "########G###########################G########", "########BB#########################BB########", "#########BB#######################BB#########", "###########BB#########F#########BB###########", "#############BBBBBBBBBBBBBBBBBBB#############")
                .aisle("############BBBBBBBBBBBBBBBBBBBBB############", "#########BBB##########F##########BBB#########", "########B###########################B########", "#######B#############################B#######", "#######G#############################G#######", "#######G#############################G#######", "#######G#############################G#######", "#######B#############################B#######", "########B###########################B########", "#########BBB##########F##########BBB#########", "############BBBBBBBBBBBBBBBBBBBBB############")
                .aisle("##########BBBBBBBBBBBBBBBBBBBBBBBBB##########", "########BB############F############BB########", "#######B#############################B#######", "######BF#############################FB######", "######GF#############################FG######", "######GF#############################FG######", "######GF#############################FG######", "######BF#############################FB######", "#######B#############################B#######", "########BB############F############BB########", "##########BBBBBBBBBBBBBBBBBBBBBBBBB##########")
                .aisle("#########BBBBBBBBB#########BBBBBBBBB#########", "#######BB#########BBBBBBBBB#########BB#######", "######B#F#############F#############F#B######", "#####B#################################B#####", "#####G#################################G#####", "#####G#################################G#####", "#####G#################################G#####", "#####B#################################B#####", "######B#F#############F#############F#B######", "#######BB#########BBBBBBBBB#########BB#######", "#########BBBBBBBBB#########BBBBBBBBB#########")
                .aisle("########BBBBBBBB#############BBBBBBBB########", "######BB#F######BBBB#####BBBB######F#BB######", "#####B#############BBBBBBB#############B#####", "#####B################F################B#####", "####G##############cccFccc##############G####", "####G#################F#################G####", "####G#################F#################G####", "#####B################F################B#####", "#####B#############BBBBBBB#############B#####", "######BB#F######BBBB#####BBBB######F#BB######", "########BBBBBBBB#############BBBBBBBB########")
                .aisle("#######BBBBBBB#################BBBBBBB#######", "######B###F###BBB###########BBB###F###B######", "#####B###########BB#######BB###########B#####", "####B#############BBBBBBBBB#############B####", "####G############ccGGGGGGGcc############G####", "###G###############GGGCGGG###############G###", "####G##############GGGGGGG##############G####", "####B#############BBBBBBBBB#############B####", "#####B###########BB#######BB###########B#####", "######B###F###BBB###########BBB###F###B######", "#######BBBBBBB#################BBBBBBB#######")
                .aisle("#######BBBBBB###################BBBBBB#######", "#####BB####F#BB###############BB#F####BB#####", "####B##########BB###########BB##########B####", "###B############BB#########BB############B###", "###G###########ccGG#######GGc############G###", "###G#############GG#######GG#############G###", "###G#############GG#######GG#############G###", "###B############BB#########BB############B###", "####B##########BB###########BB##########B####", "#####BB####F#BB###############BB#F####BB#####", "#######BBBBBB###################BBBBBB#######")
                .aisle("######BBBBBB#####################BBBBBB######", "####BB######BB#################BB######BB####", "###B########F#B###############B#F########B###", "###B###########B#############B###########B###", "##G###########cGG###########GGc###########G##", "##G############GG###########GG############G##", "##G############GG###########GG############G##", "###B###########B#############B###########B###", "###B########F#B###############B#F########B###", "####BB######BB#################BB######BB####", "######BBBBBB#####################BBBBBB######")
                .aisle("#####BBBBBB#######################BBBBBB#####", "####B######BB###################BB######B####", "###B#########B#################B#########B###", "##B##########FB###############BF##########B##", "##G##########FG###############GF##########G##", "##G##########FG###############GF##########G##", "##G##########FG###############GF##########G##", "##B##########FB###############BF##########B##", "###B#########B#################B#########B###", "####B######BB###################BB######B####", "#####BBBBBB#######################BBBBBB#####")
                .aisle("#####BBBBB#########################BBBBB#####", "###BB#####BB#####################BB#####BB###", "##B#########B###################B#########B##", "##B##########B#################B##########B##", "##G#########cG#################Gc#########G##", "#G###########G#################G###########G#", "##G##########G#################G##########G##", "##B##########B#################B##########B##", "##B#########B###################B#########B##", "###BB#####BB#####################BB#####BB###", "#####BBBBB#########################BBBBB#####")
                .aisle("#####BBBBB#########################BBBBB#####", "###BB#####B#######################B#####BB###", "##B########B#####################B########B##", "##B#########B###################B#########B##", "#G#########cG###################Gc#########G#", "#G##########G###################G##########G#", "#G##########G###################G##########G#", "##B#########B###################B#########B##", "##B########B#####################B########B##", "###BB#####B#######################B#####BB###", "#####BBBBB#########################BBBBB#####")
                .aisle("####BBBBB###########################BBBBB####", "###B#####BB#######################BB#####BB##", "##B########B#####################B########B##", "#B#########B#####################B#########B#", "#G#########cG###################Gc#########G#", "#G##########G###################G##########G#", "#G##########G###################G##########G#", "#B#########B#####################B#########B#", "##B########B#####################B########B##", "###B#####BB#######################BB#####BB##", "####BBBBB###########################BBBBB####")
                .aisle("####BBBBB###########################BBBBB####", "##BB#####B#########################B#####BB##", "#B########B#######################B########B#", "#B#########B#####################B#########B#", "#G########cG#####################Gc########G#", "#G#########G#####################G#########G#", "#G#########G#####################G#########G#", "#B#########B#####################B#########B#", "#B########B#######################B########B#", "##BB#####B#########################B#####BB##", "####BBBBB###########################BBBBB####")
                .aisle("####BBBB#############################BBBB####", "##BB####BB#########################BB####BB##", "#B########B#######################B########B#", "#B########B#######################B########B#", "G#########cG#####################Gc#########G", "G##########G#####################G##########G", "G##########G#####################G##########G", "#B########B#######################B########B#", "#B########B#######################B########B#", "##BB####BB#########################BB####BB##", "####BBBB#############################BBBB####")
                .aisle("###BBBBB#############################BBBBB###", "##B#####BB#########################BB#####B##", "#B#######B#########################B#######B#", "#B########B#######################B########B#", "G########cG#######################Gc########G", "G#########G#######################G#########G", "G#########G#######################G#########G", "#B########B#######################B########B#", "#B#######B#########################B#######B#", "##B#####BB#########################BB#####B##", "###BBBBB#############################BBBBB###")
                .aisle("###BBBBB#############################BBBBB###", "##B#####B###########################B#####B##", "#B#######B#########################B#######B#", "#B########B#######################B########B#", "G########cG#######################Gc########G", "G#########G#######################G#########G", "G#########G#######################G#########G", "#B########B#######################B########B#", "#B#######B#########################B#######B#", "##B#####B###########################B#####B##", "###BBBBB#############################BBBBB###")
                .aisle("###BBBBB#############################BBBBB###", "##B#####B###########################B#####B##", "#B#######B#########################B#######B#", "B#########B#######################B#########B", "G########cG#######################Gc########G", "G#########G#######################G#########G", "G#########G#######################G#########G", "B#########B#######################B#########B", "#B#######B#########################B#######B#", "##B#####B###########################B#####B##", "###BBBBB#############################BBBBB###")
 /**/           .aisle("###BBBBB#############################BBBBB###", "##BFFFFFB###########################BFFFFFB##", "#BF#####FB#########################BFF###FFB#", "BF#######FB#######################BF#######FB", "GF#######FG#######################GF#######FG", "GF#######FG#######################GF#######FG", "GF#######FG#######################GF#######FG", "BF#######FB#######################BF#######FB", "#BF#####FB#########################BF#####FB#", "##BFFFFFB###########################BFFFFFB##", "###BBBBB#############################BBBBB###")
                .aisle("###BBBBB#############################BBBBB###", "##B#####B###########################B#####B##", "#B#######B#########################B#######B#", "B#########B#######################B#########B", "G########cG#######################Gc########G", "G#########G#######################G#########G", "G#########G#######################G#########G", "B#########B#######################B#########B", "#B#######B#########################B#######B#", "##B#####B###########################B#####B##", "###BBBBB#############################BBBBB###")
                .aisle("###BBBBB#############################BBBBB###", "##B#####B###########################B#####B##", "#B#######B#########################B#######B#", "#B########B#######################B########B#", "G########cG#######################Gc########G", "G#########G#######################G#########G", "G#########G#######################G#########G", "#B########B#######################B########B#", "#B#######B#########################B#######B#", "##B#####B###########################B#####B##", "###BBBBB#############################BBBBB###")
                .aisle("###BBBBB#############################BBBBB###", "##B#####BB#########################BB#####B##", "#B#######B#########################B#######B#", "#B########B#######################B########B#", "G########cG#######################Gc########G", "G#########G#######################G#########G", "G#########G#######################G#########G", "#B########B#######################B########B#", "#B#######B#########################B#######B#", "##B#####BB#########################BB#####B##", "###BBBBB#############################BBBBB###")
                .aisle("####BBBB#############################BBBB####", "##BB####BB#########################BB####BB##", "#B########B#######################B########B#", "#B########B#######################B########B#", "G#########cG#####################Gc#########G", "G##########G#####################G##########G", "G##########G#####################G##########G", "#B########B#######################B########B#", "#B########B#######################B########B#", "##BB####BB#########################BB####BB##", "####BBBB#############################BBBB####")
                .aisle("####BBBBB###########################BBBBB####", "##BB#####B#########################B#####BB##", "#B########B#######################B########B#", "#B#########B#####################B#########B#", "#G########cG#####################Gc########G#", "#G#########G#####################G#########G#", "#G#########G#####################G#########G#", "#B#########B#####################B#########B#", "#B########B#######################B########B#", "##BB#####B#########################B#####BB##", "####BBBBB###########################BBBBB####")
                .aisle("####BBBBB###########################BBBBB####", "##BB#####BB#######################BB#####BB##", "##B########B#####################B########B##", "#B#########B#####################B#########B#", "#G#########cG###################Gc#########G#", "#G##########G###################G##########G#", "#G##########G###################G##########G#", "#B#########B#####################B#########B#", "##B########B#####################B########B##", "##BB#####BB#######################BB#####BB##", "####BBBBB###########################BBBBB####")
                .aisle("#####BBBBB#########################BBBBB#####", "###BB#####B#######################B#####BB###", "##B########B#####################B########B##", "##B#########B###################B#########B##", "#G#########cG###################Gc#########G#", "#G##########G###################G##########G#", "#G##########G###################G##########G#", "##B#########B###################B#########B##", "##B########B#####################B########B##", "###BB#####B#######################B#####BB###", "#####BBBBB#########################BBBBB#####")
                .aisle("#####BBBBB#########################BBBBB#####", "###BB#####BB#####################BB#####BB###", "##B#########B###################B#########B##", "##B##########B#################B##########B##", "##G#########cG#################Gc#########G##", "#G###########G#################G###########G#", "##G##########G#################G##########G##", "##B##########B#################B##########B##", "##B#########B###################B#########B##", "###BB#####BB#####################BB#####BB###", "#####BBBBB#########################BBBBB#####")
                .aisle("#####BBBBBB#######################BBBBBB#####", "####B######BB###################BB######B####", "###B#########B#################B#########B###", "##B##########FB###############BF##########B##", "##G##########FG###############GF##########G##", "##G##########FG###############GF##########G##", "##G##########FG###############GF##########G##", "##B##########FB###############BF##########B##", "###B#########B#################B#########B###", "####B######BB###################BB######B####", "#####BBBBBB#######################BBBBBB#####")
                .aisle("######BBBBBB#####################BBBBBB######", "####BB######BB#################BB######BB####", "###B########F#B###############B#F########B###", "###B###########B#############B###########B###", "##G###########cGG###########GGc###########G##", "##G############GG###########GG############G##", "##G############GG###########GG############G##", "###B###########B#############B###########B###", "###B########F#B###############B#F########B###", "####BB######BB#################BB######BB####", "######BBBBBB#####################BBBBBB######")
                .aisle("#######BBBBBB###################BBBBBB#######", "#####BB####F#BB###############BB#F####BB#####", "####B##########BB###########BB##########B####", "###B############BB#########BB############B###", "###G###########ccGG#######GGcc###########G###", "###G#############GG#######GG#############G###", "###G#############GG#######GG#############G###", "###B############BB#########BB############B###", "####B##########BB###########BB##########B####", "#####BB####F#BB###############BB#F####BB#####", "#######BBBBBB###################BBBBBB#######")
                .aisle("#######BBBBBBB#################BBBBBBB#######", "######B###F###BBB###########BBB###F###B######", "#####B###########BB#######BB###########B#####", "####B#############BBBBBBBBB#############B####", "####G############ccGGGGGGGcc############G####", "###G###############GGGGGGG###############G###", "####G##############GGGGGGG##############G####", "####B#############BBBBBBBBB#############B####", "#####B###########BB#######BB###########B#####", "######B###F###BBB###########BBB###F###B######", "#######BBBBBBB#################BBBBBBB#######")
                .aisle("########BBBBBBBB#############BBBBBBBB########", "######BB#F######BBBB#####BBBB######F#BB######", "#####B#############BBBBBBB#############B#####", "#####B################F################B#####", "####G##############cccFccc##############G####", "####G#################F#################G####", "####G#################F#################G####", "#####B################F################B#####", "#####B#############BBBBBBB#############B#####", "######BB#F######BBBB#####BBBB######F#BB######", "########BBBBBBBB#############BBBBBBBB########")
                .aisle("#########BBBBBBBBB#########BBBBBBBBB#########", "#######BB#########BBBBBBBBB#########BB#######", "######B#F#############F#############F#B######", "#####B#################################B#####", "#####G#################################G#####", "#####G#################################G#####", "#####G#################################G#####", "#####B#################################B#####", "######B#F#############F#############F#B######", "#######BB#########BBBBBBBBB#########BB#######", "#########BBBBBBBBB#########BBBBBBBBB#########")
                .aisle("##########BBBBBBBBBBBBBBBBBBBBBBBBB##########", "########BB############F############BB########", "#######B#############################B#######", "######BF#############################FB######", "######GF#############################FG######", "######GF#############################FG######", "######GF#############################FG######", "######BF#############################FB######", "#######B#############################B#######", "########BB############F############BB########", "##########BBBBBBBBBBBBBBBBBBBBBBBBB##########")
                .aisle("############BBBBBBBBBBBBBBBBBBBBB############", "#########BBB##########F##########BBB#########", "########B###########################B########", "#######B#############################B#######", "#######G#############################G#######", "#######G#############################G#######", "#######G#############################G#######", "#######B#############################B#######", "########B###########################B########", "#########BBB##########F##########BBB#########", "############BBBBBBBBBBBBBBBBBBBBB############")
                .aisle("#############BBBBBBBBBBBBBBBBBBB#############", "###########BB#########F#########BB###########", "#########BB#######################BB#########", "########BB#########################BB########", "########G###########################G########", "########G###########################G########", "########G###########################G########", "########BB#########################BB########", "#########BB#######################BB#########", "###########BB#########F#########BB###########", "#############BBBBBBBBBBBBBBBBBBB#############")
                .aisle("################BBBBBBBBBBBBB################", "############BBBB######F######BBBB############", "###########B#####################B###########", "##########B#######################B##########", "#########GG#######################GG#########", "#########G#########################G#########", "#########GG#######################GG#########", "##########B#######################B##########", "###########B#####################B###########", "############BBBB######F######BBBB############", "################BBBBBBBBBBBBB################")
                .aisle("###################BBBBBBB###################", "##############BBBBB###F###BBBBB##############", "############BB#################BB############", "###########BB###################BB###########", "###########G#####################G###########", "##########GG#####################GG##########", "###########G#####################G###########", "###########BB###################BB###########", "############BB#################BB############", "##############BBBBB###F###BBBBB##############", "###################BBBBBBB###################")
                .aisle("#############################################", "#################BBBBBBBBBBB#################", "##############BBB#####F#####BBB##############", "#############BBB#############BBB#############", "############GGG###############GGG############", "############GG#################GG############", "############GGG###############GGG############", "#############BBB#############BBB#############", "##############BBB#####F#####BBB##############", "#################BBBBBBBBBBB#################", "#############################################")
                .aisle("#############################################", "#############################################", "#################BBBBBBBBBBB#################", "################BBBB##F##BBBB################", "###############GGG####F####GGG###############", "##############GGGG####F####GGGG##############", "###############GGG####F####GGG###############", "################BBBB##F##BBBB################", "#################BBBBBBBBBBB#################", "#############################################", "#############################################")
                .aisle("#############################################", "#############################################", "#############################################", "####################BBBBB####################", "##################GGGGGGGGG##################", "##################GGGGGGGGG##################", "##################GGGGGGGGG##################", "####################BBBBB####################", "#############################################", "#############################################", "#############################################")
                .where('#', any())
                .where('C', selfPredicate())
                .where('c', getFusionCoils())
                .where('A', air())
                .where('B', states(getCasingState()).setMinGlobalLimited(2000))
                .where('F', states(MetaBlocks.FRAMES.get(TungstenSteel).getBlock(TungstenSteel)))
                .where('G', states(MetaBlocks.TRANSPARENT_CASING.getState(BlockGlassCasing.CasingType.FUSION_GLASS)).setMaxGlobalLimited(120).or(states(getCasingState())))
                .build();
    }

    @Override
    public void update() {
    }

    public ICubeRenderer getBaseTexture(IMultiblockPart iMultiblockPart) { return TJTextures.TreeFarmerController; }

    private IBlockState getCasingState() {
        return MetaBlocks.FUSION_CASING.getState(BlockFusionCasing.CasingType.FUSION_CASING_MK3);
    }

    private TraceabilityPredicate getFusionCoils() {
        return new TraceabilityPredicate(blockWorldState -> {
            BlockInfo blockInfo = TraceabilityPredicate.HEATING_COILS.get().common.get(0).candidates.get()[0];
            IBlockState blockState = blockInfo.getBlockState();
            if (blockState.getBlock() instanceof BlockWireCoil) {
                BlockWireCoil wireCoil = (BlockWireCoil) blockState.getBlock();
                BlockWireCoil.CoilType coilType = wireCoil.getState(blockState);
                if (coilType.ordinal() < 4) {
                    return false;
                }
                return true;
            }
            return false;
        }, () -> ArrayUtils.addAll(
                Arrays.stream(BlockWireCoil.CoilType.values()).map(type -> new BlockInfo(MetaBlocks.WIRE_COIL.getState(type), null)).toArray(BlockInfo[]::new)))
                .addTooltips("gregtech.multiblock.pattern.error.coils");

    }

    @Override
    public MetaTileEntity createMetaTileEntity(MetaTileEntityHolder metaTileEntityHolder) {
        return new MegaFusion(metaTileEntityId);
    }

    @Nonnull
    @Override
    protected ICubeRenderer getFrontOverlay() {
        return Textures.MULTIBLOCK_WORKABLE_OVERLAY;
    }

    @Override
    public boolean hasMaintenanceMechanics() {
        return false;
    }



}
